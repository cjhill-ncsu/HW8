[
  {
    "objectID": "HW8.html",
    "href": "HW8.html",
    "title": "HW8",
    "section": "",
    "text": "library(tidyverse)\nlibrary(lubridate)\nlibrary(tidymodels)\n\nset.seed(123)"
  },
  {
    "objectID": "HW8.html#read-data",
    "href": "HW8.html#read-data",
    "title": "HW8",
    "section": "Read Data",
    "text": "Read Data\nThe SeoulBikeData.csv contains characters not encoded in UTF-8 (the default encoding in readr). Because of this, we specify the encoding as latin1.\n\ndata &lt;- read_csv(\"SeoulBikeData.csv\", locale=locale(encoding=\"latin1\"))"
  },
  {
    "objectID": "HW8.html#eda",
    "href": "HW8.html#eda",
    "title": "HW8",
    "section": "EDA",
    "text": "EDA\n\nMissing Values\nFirst we check for missing values and luckily there are none to consider\n\nanyNA(data)\n\n[1] FALSE\n\n\n\n\nCheck Columns\nCheck the columns and the unique levels of chatagorical variables.\n\nglimpse(data)\n\nRows: 8,760\nColumns: 14\n$ Date                        &lt;chr&gt; \"01/12/2017\", \"01/12/2017\", \"01/12/2017\", …\n$ `Rented Bike Count`         &lt;dbl&gt; 254, 204, 173, 107, 78, 100, 181, 460, 930…\n$ Hour                        &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, …\n$ `Temperature(°C)`           &lt;dbl&gt; -5.2, -5.5, -6.0, -6.2, -6.0, -6.4, -6.6, …\n$ `Humidity(%)`               &lt;dbl&gt; 37, 38, 39, 40, 36, 37, 35, 38, 37, 27, 24…\n$ `Wind speed (m/s)`          &lt;dbl&gt; 2.2, 0.8, 1.0, 0.9, 2.3, 1.5, 1.3, 0.9, 1.…\n$ `Visibility (10m)`          &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, …\n$ `Dew point temperature(°C)` &lt;dbl&gt; -17.6, -17.6, -17.7, -17.6, -18.6, -18.7, …\n$ `Solar Radiation (MJ/m2)`   &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, …\n$ `Rainfall(mm)`              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n$ `Snowfall (cm)`             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n$ Seasons                     &lt;chr&gt; \"Winter\", \"Winter\", \"Winter\", \"Winter\", \"W…\n$ Holiday                     &lt;chr&gt; \"No Holiday\", \"No Holiday\", \"No Holiday\", …\n$ `Functioning Day`           &lt;chr&gt; \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", …\n\nunique(data$Seasons)\n\n[1] \"Winter\" \"Spring\" \"Summer\" \"Autumn\"\n\nunique(data$Holiday)\n\n[1] \"No Holiday\" \"Holiday\"   \n\nunique(data$`Functioning Day`)\n\n[1] \"Yes\" \"No\" \n\n\n\n\nConvert Date Column\nUsing lubridate to convert the date column to a date object.\n\ndata$Date &lt;- dmy(data$Date)\n\n\n\nCategorical Columns to Factors\n\ndata$Seasons &lt;- as.factor(data$Seasons)\ndata$Holiday &lt;- as.factor(data$Holiday)\ndata$`Functioning Day` &lt;- as.factor(data$`Functioning Day`)\n\n\n\nRename Columns\n\ndata &lt;- data |&gt; rename(\n  rented_bike_count = `Rented Bike Count`,\n  temperature = `Temperature(°C)`,\n  humidity = `Humidity(%)`,\n  wind_speed = `Wind speed (m/s)`,\n  visibility = `Visibility (10m)`,\n  dew_point_temp = `Dew point temperature(°C)`,\n  solar_radiation = `Solar Radiation (MJ/m2)`,\n  rainfall = `Rainfall(mm)`,\n  snowfall = `Snowfall (cm)`,\n  functioning_day = `Functioning Day`,\n  date = Date,\n  hour = Hour,\n  season = Seasons,\n  holiday = Holiday\n)\nglimpse(data)\n\nRows: 8,760\nColumns: 14\n$ date              &lt;date&gt; 2017-12-01, 2017-12-01, 2017-12-01, 2017-12-01, 201…\n$ rented_bike_count &lt;dbl&gt; 254, 204, 173, 107, 78, 100, 181, 460, 930, 490, 339…\n$ hour              &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15…\n$ temperature       &lt;dbl&gt; -5.2, -5.5, -6.0, -6.2, -6.0, -6.4, -6.6, -7.4, -7.6…\n$ humidity          &lt;dbl&gt; 37, 38, 39, 40, 36, 37, 35, 38, 37, 27, 24, 21, 23, …\n$ wind_speed        &lt;dbl&gt; 2.2, 0.8, 1.0, 0.9, 2.3, 1.5, 1.3, 0.9, 1.1, 0.5, 1.…\n$ visibility        &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000…\n$ dew_point_temp    &lt;dbl&gt; -17.6, -17.6, -17.7, -17.6, -18.6, -18.7, -19.5, -19…\n$ solar_radiation   &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.01…\n$ rainfall          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ snowfall          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ season            &lt;fct&gt; Winter, Winter, Winter, Winter, Winter, Winter, Wint…\n$ holiday           &lt;fct&gt; No Holiday, No Holiday, No Holiday, No Holiday, No H…\n$ functioning_day   &lt;fct&gt; Yes, Yes, Yes, Yes, Yes, Yes, Yes, Yes, Yes, Yes, Ye…\n\n\n\n\nSummary Statistics\nReusable function for grouped sumary stats\n\nsummary(data)\n\n      date            rented_bike_count      hour        temperature    \n Min.   :2017-12-01   Min.   :   0.0    Min.   : 0.00   Min.   :-17.80  \n 1st Qu.:2018-03-02   1st Qu.: 191.0    1st Qu.: 5.75   1st Qu.:  3.50  \n Median :2018-06-01   Median : 504.5    Median :11.50   Median : 13.70  \n Mean   :2018-06-01   Mean   : 704.6    Mean   :11.50   Mean   : 12.88  \n 3rd Qu.:2018-08-31   3rd Qu.:1065.2    3rd Qu.:17.25   3rd Qu.: 22.50  \n Max.   :2018-11-30   Max.   :3556.0    Max.   :23.00   Max.   : 39.40  \n    humidity       wind_speed      visibility   dew_point_temp   \n Min.   : 0.00   Min.   :0.000   Min.   :  27   Min.   :-30.600  \n 1st Qu.:42.00   1st Qu.:0.900   1st Qu.: 940   1st Qu.: -4.700  \n Median :57.00   Median :1.500   Median :1698   Median :  5.100  \n Mean   :58.23   Mean   :1.725   Mean   :1437   Mean   :  4.074  \n 3rd Qu.:74.00   3rd Qu.:2.300   3rd Qu.:2000   3rd Qu.: 14.800  \n Max.   :98.00   Max.   :7.400   Max.   :2000   Max.   : 27.200  \n solar_radiation     rainfall          snowfall          season    \n Min.   :0.0000   Min.   : 0.0000   Min.   :0.00000   Autumn:2184  \n 1st Qu.:0.0000   1st Qu.: 0.0000   1st Qu.:0.00000   Spring:2208  \n Median :0.0100   Median : 0.0000   Median :0.00000   Summer:2208  \n Mean   :0.5691   Mean   : 0.1487   Mean   :0.07507   Winter:2160  \n 3rd Qu.:0.9300   3rd Qu.: 0.0000   3rd Qu.:0.00000                \n Max.   :3.5200   Max.   :35.0000   Max.   :8.80000                \n       holiday     functioning_day\n Holiday   : 432   No : 295       \n No Holiday:8328   Yes:8465       \n                                  \n                                  \n                                  \n                                  \n\nsummarize_bike_rentals &lt;- function(data, group_vars) {\n  data |&gt;\n    group_by(across(all_of(group_vars))) |&gt;\n    summarize(\n      min_bike_count = min(rented_bike_count, na.rm = TRUE),\n      mean_bike_count = mean(rented_bike_count, na.rm = TRUE),\n      median_bike_count = median(rented_bike_count, na.rm = TRUE),\n      max_bike_count = max(rented_bike_count, na.rm = TRUE),\n      sd_bike_count = sd(rented_bike_count, na.rm = TRUE),\n      .groups = \"drop\" \n    ) |&gt;\n    knitr::kable()\n}\n\n\nGrouped by Catagorical Variables\n\nsummarize_bike_rentals(data, \"season\")\n\n\n\n\n\n\n\n\n\n\n\n\nseason\nmin_bike_count\nmean_bike_count\nmedian_bike_count\nmax_bike_count\nsd_bike_count\n\n\n\n\nAutumn\n0\n819.5980\n763.5\n3298\n651.0856\n\n\nSpring\n0\n730.0312\n583.0\n3251\n621.5096\n\n\nSummer\n9\n1034.0734\n905.5\n3556\n690.2448\n\n\nWinter\n3\n225.5412\n203.0\n937\n150.3722\n\n\n\n\n\n\nsummarize_bike_rentals(data, \"holiday\")\n\n\n\n\n\n\n\n\n\n\n\n\nholiday\nmin_bike_count\nmean_bike_count\nmedian_bike_count\nmax_bike_count\nsd_bike_count\n\n\n\n\nHoliday\n0\n499.7569\n240.0\n2400\n570.7728\n\n\nNo Holiday\n0\n715.2280\n524.5\n3556\n646.8791\n\n\n\n\n\nNote that the No Functioning Days have no statistics to report\n\nsummarize_bike_rentals(data, \"functioning_day\")\n\n\n\n\n\n\n\n\n\n\n\n\nfunctioning_day\nmin_bike_count\nmean_bike_count\nmedian_bike_count\nmax_bike_count\nsd_bike_count\n\n\n\n\nNo\n0\n0.000\n0\n0\n0.0000\n\n\nYes\n2\n729.157\n542\n3556\n642.3512\n\n\n\n\n\n\n\n\nSubset on Functioning Days\n\nfunctioning_data &lt;- data |&gt; filter(functioning_day == \"Yes\")\n\n\n\nSummarize Across the Hours\n\nSummarize across the hours so that each day has one observation associated with it.\nGroup by the date, seasons, and holiday variables.\nFind the sum of the bike_count, rainfall, and snowfall variables\nFind the mean of all the weather related variables.\n\n\ndaily_functioning_data &lt;- functioning_data |&gt;\n  group_by(date, season, holiday) |&gt;\n  summarize(\n    total_bike_count = sum(rented_bike_count),\n    total_rainfall = sum(rainfall),\n    total_snowfall = sum(snowfall),\n    avg_temperature = mean(temperature),\n    avg_humidity = mean(humidity),\n    avg_wind_speed = mean(wind_speed),\n    avg_visibility = mean(visibility),\n    avg_dew_point_temp = mean(dew_point_temp),\n    avg_solar_radiation = mean(solar_radiation),\n    .groups = \"drop\"\n  )\n\nsummary(daily_functioning_data)\n\n      date               season         holiday    total_bike_count\n Min.   :2017-12-01   Autumn:81   Holiday   : 17   Min.   :  977   \n 1st Qu.:2018-02-27   Spring:90   No Holiday:336   1st Qu.: 6967   \n Median :2018-05-28   Summer:92                    Median :18563   \n Mean   :2018-05-28   Winter:90                    Mean   :17485   \n 3rd Qu.:2018-08-24                                3rd Qu.:26285   \n Max.   :2018-11-30                                Max.   :36149   \n total_rainfall   total_snowfall   avg_temperature    avg_humidity  \n Min.   : 0.000   Min.   : 0.000   Min.   :-14.738   Min.   :22.25  \n 1st Qu.: 0.000   1st Qu.: 0.000   1st Qu.:  3.304   1st Qu.:47.58  \n Median : 0.000   Median : 0.000   Median : 13.738   Median :57.17  \n Mean   : 3.576   Mean   : 1.863   Mean   : 12.776   Mean   :58.17  \n 3rd Qu.: 0.500   3rd Qu.: 0.000   3rd Qu.: 22.592   3rd Qu.:67.71  \n Max.   :95.500   Max.   :78.700   Max.   : 33.742   Max.   :95.88  \n avg_wind_speed   avg_visibility   avg_dew_point_temp avg_solar_radiation\n Min.   :0.6625   Min.   : 214.3   Min.   :-27.750    Min.   :0.02917    \n 1st Qu.:1.3042   1st Qu.:1087.0   1st Qu.: -5.188    1st Qu.:0.28333    \n Median :1.6583   Median :1557.8   Median :  4.612    Median :0.56500    \n Mean   :1.7261   Mean   :1434.0   Mean   :  3.954    Mean   :0.56773    \n 3rd Qu.:1.9542   3rd Qu.:1874.3   3rd Qu.: 14.921    3rd Qu.:0.82000    \n Max.   :4.0000   Max.   :2000.0   Max.   : 25.038    Max.   :1.21667    \n\n\n\n\nBasic Summary Stats and Correlations\n\nsummary(daily_functioning_data$total_bike_count)\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n    977    6967   18563   17485   26285   36149 \n\nnumeric_vars &lt;- daily_functioning_data |&gt; select_if(is.numeric)\n\ncor_matrix &lt;- cor(numeric_vars, use = \"complete.obs\")\n\ncor_matrix |&gt; knitr::kable()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ntotal_bike_count\ntotal_rainfall\ntotal_snowfall\navg_temperature\navg_humidity\navg_wind_speed\navg_visibility\navg_dew_point_temp\navg_solar_radiation\n\n\n\n\ntotal_bike_count\n1.0000000\n-0.2391091\n-0.2652911\n0.7530767\n0.0358870\n-0.1928814\n0.1659937\n0.6504765\n0.7358929\n\n\ntotal_rainfall\n-0.2391091\n1.0000000\n-0.0231340\n0.1445173\n0.5286426\n-0.1016758\n-0.2219939\n0.2645662\n-0.3227041\n\n\ntotal_snowfall\n-0.2652911\n-0.0231340\n1.0000000\n-0.2669637\n0.0653919\n0.0208816\n-0.1018890\n-0.2095529\n-0.2334306\n\n\navg_temperature\n0.7530767\n0.1445173\n-0.2669637\n1.0000000\n0.4041675\n-0.2607218\n0.0023367\n0.9627963\n0.5502743\n\n\navg_humidity\n0.0358870\n0.5286426\n0.0653919\n0.4041675\n1.0000000\n-0.2342578\n-0.5591773\n0.6320473\n-0.2744497\n\n\navg_wind_speed\n-0.1928814\n-0.1016758\n0.0208816\n-0.2607218\n-0.2342578\n1.0000000\n0.2060226\n-0.2877032\n0.0961263\n\n\navg_visibility\n0.1659937\n-0.2219939\n-0.1018890\n0.0023367\n-0.5591773\n0.2060226\n1.0000000\n-0.1535516\n0.2713959\n\n\navg_dew_point_temp\n0.6504765\n0.2645662\n-0.2095529\n0.9627963\n0.6320473\n-0.2877032\n-0.1535516\n1.0000000\n0.3831571\n\n\navg_solar_radiation\n0.7358929\n-0.3227041\n-0.2334306\n0.5502743\n-0.2744497\n0.0961263\n0.2713959\n0.3831571\n1.0000000\n\n\n\n\n\n\n\nVisual\nSince Average temperature is the most highly correlated with Bike rentals, let’s plot it and have a look.\n\nggplot(daily_functioning_data, \n       aes(x = avg_temperature, \n           y = total_bike_count)\n       ) +\n  geom_point() +\n  labs(\n    title = \"Daily Bike Rentals vs. Average Temperature\",\n    x = \"Average Temperature (Degrees C)\",\n    y = \"Total Bike Rentals\"\n  )"
  },
  {
    "objectID": "HW8.html#split-data",
    "href": "HW8.html#split-data",
    "title": "HW8",
    "section": "Split Data",
    "text": "Split Data\nNote: It was mentioned in the lecture that this might be done before our EDA to avoid the potential of involving our test set. Here we are following the guidelines set in the assignment.\n\ndata_split &lt;- initial_split(daily_functioning_data, \n                            prop = 0.75, \n                            strata = season)\n\ntrain_data &lt;- training(data_split)\ntest_data &lt;- testing(data_split)\n\ncv_folds &lt;- vfold_cv(train_data, v = 10)\ncv_folds\n\n#  10-fold cross-validation \n# A tibble: 10 × 2\n   splits           id    \n   &lt;list&gt;           &lt;chr&gt; \n 1 &lt;split [236/27]&gt; Fold01\n 2 &lt;split [236/27]&gt; Fold02\n 3 &lt;split [236/27]&gt; Fold03\n 4 &lt;split [237/26]&gt; Fold04\n 5 &lt;split [237/26]&gt; Fold05\n 6 &lt;split [237/26]&gt; Fold06\n 7 &lt;split [237/26]&gt; Fold07\n 8 &lt;split [237/26]&gt; Fold08\n 9 &lt;split [237/26]&gt; Fold09\n10 &lt;split [237/26]&gt; Fold10"
  },
  {
    "objectID": "HW8.html#linear-models",
    "href": "HW8.html#linear-models",
    "title": "HW8",
    "section": "Linear Models",
    "text": "Linear Models\n\nRecipes (preprocessing)\n\nRecipe 1\nThe addition of the weekday/weekend factor in the recipe is causing considerable trouble. Here we will go step by step to show my steps to address the issue. I found this very helpful in understand how the recipe is being constructed.\nThe matter at hand was simply errors involving column names. “dow” for instance was created as “date_dow”. And the date_dow values were three letter abbreviations for the days. The errors have been identified and removed for this assignement.\n\nshow_glimpse &lt;- function(recipe) {\n  recipe |&gt; \n    prep(training = train_data) |&gt; \n    bake(new_data = NULL) |&gt; \n    glimpse()\n}\n\ndebug_recipe &lt;- recipe(total_bike_count ~ ., data = train_data) |&gt;\n  update_role(date, new_role = \"ID\") |&gt;\n  step_date(date, features = \"dow\")\n\nshow_glimpse(debug_recipe)\n\nRows: 263\nColumns: 13\n$ date                &lt;date&gt; 2018-09-05, 2018-09-06, 2018-09-07, 2018-09-08, 2…\n$ season              &lt;fct&gt; Autumn, Autumn, Autumn, Autumn, Autumn, Autumn, Au…\n$ holiday             &lt;fct&gt; No Holiday, No Holiday, No Holiday, No Holiday, No…\n$ total_rainfall      &lt;dbl&gt; 0.0, 0.0, 1.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.2, …\n$ total_snowfall      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ avg_temperature     &lt;dbl&gt; 23.837500, 24.250000, 22.158333, 21.691667, 21.958…\n$ avg_humidity        &lt;dbl&gt; 61.79167, 70.79167, 56.87500, 48.66667, 49.45833, …\n$ avg_wind_speed      &lt;dbl&gt; 2.5041667, 1.8958333, 2.4791667, 1.6666667, 1.2333…\n$ avg_visibility      &lt;dbl&gt; 1954.1667, 1635.2500, 1848.7083, 1982.1250, 1997.1…\n$ avg_dew_point_temp  &lt;dbl&gt; 15.4416667, 18.2625000, 12.6458333, 9.8041667, 10.…\n$ avg_solar_radiation &lt;dbl&gt; 0.9358333, 0.4595833, 0.8158333, 0.9479167, 0.8916…\n$ total_bike_count    &lt;dbl&gt; 31114, 27838, 30381, 29813, 28354, 30781, 31809, 3…\n$ date_dow            &lt;fct&gt; Wed, Thu, Fri, Sat, Sun, Mon, Wed, Thu, Fri, Sat, …\n\n\n\ndebug_recipe &lt;- debug_recipe |&gt;\n  step_mutate(\n    day_type = factor(\n      if_else(date_dow %in% c(\"Sat\", \"Sun\"), \"weekend\", \"weekday\")\n    )\n  )\n\nshow_glimpse(debug_recipe)\n\nRows: 263\nColumns: 14\n$ date                &lt;date&gt; 2018-09-05, 2018-09-06, 2018-09-07, 2018-09-08, 2…\n$ season              &lt;fct&gt; Autumn, Autumn, Autumn, Autumn, Autumn, Autumn, Au…\n$ holiday             &lt;fct&gt; No Holiday, No Holiday, No Holiday, No Holiday, No…\n$ total_rainfall      &lt;dbl&gt; 0.0, 0.0, 1.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.2, …\n$ total_snowfall      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ avg_temperature     &lt;dbl&gt; 23.837500, 24.250000, 22.158333, 21.691667, 21.958…\n$ avg_humidity        &lt;dbl&gt; 61.79167, 70.79167, 56.87500, 48.66667, 49.45833, …\n$ avg_wind_speed      &lt;dbl&gt; 2.5041667, 1.8958333, 2.4791667, 1.6666667, 1.2333…\n$ avg_visibility      &lt;dbl&gt; 1954.1667, 1635.2500, 1848.7083, 1982.1250, 1997.1…\n$ avg_dew_point_temp  &lt;dbl&gt; 15.4416667, 18.2625000, 12.6458333, 9.8041667, 10.…\n$ avg_solar_radiation &lt;dbl&gt; 0.9358333, 0.4595833, 0.8158333, 0.9479167, 0.8916…\n$ total_bike_count    &lt;dbl&gt; 31114, 27838, 30381, 29813, 28354, 30781, 31809, 3…\n$ date_dow            &lt;fct&gt; Wed, Thu, Fri, Sat, Sun, Mon, Wed, Thu, Fri, Sat, …\n$ day_type            &lt;fct&gt; weekday, weekday, weekday, weekend, weekend, weekd…\n\n\n\ndebug_recipe &lt;- debug_recipe |&gt;\n  step_rm(date_dow)\n\nshow_glimpse(debug_recipe)\n\nRows: 263\nColumns: 13\n$ date                &lt;date&gt; 2018-09-05, 2018-09-06, 2018-09-07, 2018-09-08, 2…\n$ season              &lt;fct&gt; Autumn, Autumn, Autumn, Autumn, Autumn, Autumn, Au…\n$ holiday             &lt;fct&gt; No Holiday, No Holiday, No Holiday, No Holiday, No…\n$ total_rainfall      &lt;dbl&gt; 0.0, 0.0, 1.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.2, …\n$ total_snowfall      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ avg_temperature     &lt;dbl&gt; 23.837500, 24.250000, 22.158333, 21.691667, 21.958…\n$ avg_humidity        &lt;dbl&gt; 61.79167, 70.79167, 56.87500, 48.66667, 49.45833, …\n$ avg_wind_speed      &lt;dbl&gt; 2.5041667, 1.8958333, 2.4791667, 1.6666667, 1.2333…\n$ avg_visibility      &lt;dbl&gt; 1954.1667, 1635.2500, 1848.7083, 1982.1250, 1997.1…\n$ avg_dew_point_temp  &lt;dbl&gt; 15.4416667, 18.2625000, 12.6458333, 9.8041667, 10.…\n$ avg_solar_radiation &lt;dbl&gt; 0.9358333, 0.4595833, 0.8158333, 0.9479167, 0.8916…\n$ total_bike_count    &lt;dbl&gt; 31114, 27838, 30381, 29813, 28354, 30781, 31809, 3…\n$ day_type            &lt;fct&gt; weekday, weekday, weekday, weekend, weekend, weekd…\n\n\n\ndebug_recipe &lt;- debug_recipe |&gt;\n  step_dummy(season, holiday, day_type) |&gt;\n  step_normalize(all_numeric(), -all_outcomes())\n\nshow_glimpse(debug_recipe)\n\nRows: 263\nColumns: 15\n$ date                &lt;date&gt; 2018-09-05, 2018-09-06, 2018-09-07, 2018-09-08, 2…\n$ total_rainfall      &lt;dbl&gt; -0.2970185, -0.2970185, -0.1773679, -0.2970185, -0…\n$ total_snowfall      &lt;dbl&gt; -0.2179228, -0.2179228, -0.2179228, -0.2179228, -0…\n$ avg_temperature     &lt;dbl&gt; 0.942813132, 0.977863864, 0.800131869, 0.760478516…\n$ avg_humidity        &lt;dbl&gt; 0.21420205, 0.81794255, -0.11561916, -0.66625286, …\n$ avg_wind_speed      &lt;dbl&gt; 1.32331031, 0.28870706, 1.28079237, -0.10104074, -…\n$ avg_visibility      &lt;dbl&gt; 1.05187245, 0.41451440, 0.84111295, 1.10774745, 1.…\n$ avg_dew_point_temp  &lt;dbl&gt; 0.87630133, 1.09270791, 0.66181269, 0.44380783, 0.…\n$ avg_solar_radiation &lt;dbl&gt; 1.17578189, -0.32588618, 0.79740883, 1.21388195, 1…\n$ total_bike_count    &lt;dbl&gt; 31114, 27838, 30381, 29813, 28354, 30781, 31809, 3…\n$ season_Spring       &lt;dbl&gt; -0.5835555, -0.5835555, -0.5835555, -0.5835555, -0…\n$ season_Summer       &lt;dbl&gt; -0.595246, -0.595246, -0.595246, -0.595246, -0.595…\n$ season_Winter       &lt;dbl&gt; -0.5835555, -0.5835555, -0.5835555, -0.5835555, -0…\n$ holiday_No.Holiday  &lt;dbl&gt; 0.1984324, 0.1984324, 0.1984324, 0.1984324, 0.1984…\n$ day_type_weekend    &lt;dbl&gt; -0.6362954, -0.6362954, -0.6362954, 1.5656215, 1.5…\n\n\nAll together now:\n\nrecipe1 &lt;- recipe(total_bike_count ~ ., data = train_data) |&gt;\n  update_role(date, new_role = \"ID\") |&gt;\n  step_date(date, features = \"dow\") |&gt;\n  step_mutate(\n    day_type = factor(\n      if_else(date_dow %in% c(\"Sat\", \"Sun\"), \"weekend\", \"weekday\")\n    )\n  ) |&gt;\n  step_rm(date_dow) |&gt;\n  step_dummy(season, holiday, day_type) |&gt;\n  step_normalize(all_numeric(), -all_outcomes())\n\nrecipe1\n\n\n\n\n── Recipe ──────────────────────────────────────────────────────────────────────\n\n\n\n\n\n── Inputs \n\n\nNumber of variables by role\n\n\noutcome:    1\npredictor: 10\nID:         1\n\n\n\n\n\n── Operations \n\n\n• Date features from: date\n\n\n• Variable mutation for: factor(if_else(date_dow %in% c(\"Sat\", \"Sun\"),\n  \"weekend\", \"weekday\"))\n\n\n• Variables removed: date_dow\n\n\n• Dummy variables from: season, holiday, day_type\n\n\n• Centering and scaling for: all_numeric() and -all_outcomes()\n\n\n\n\nRecipe 2\nUnclear to the reason, but starts_with(“season”) did not work. Had to create the interactions manually in spite of the lecture notes in order to avoid the error.\nAlso did a google search to address the following warning: prediction from rank-deficient fit; consider predict(., rankdeficient=“NA”). This lead to the addistion of the step_corr() function.\n\nrecipe2 &lt;- recipe1 |&gt;\n  step_interact(terms = ~ season_Spring:holiday_No.Holiday + \n                          season_Summer:holiday_No.Holiday +\n                          season_Winter:holiday_No.Holiday + \n                          season_Spring:avg_temperature +\n                          season_Summer:avg_temperature + \n                          season_Winter:avg_temperature +\n                          avg_temperature:total_rainfall)\n\nshow_glimpse(recipe2)\n\nRows: 263\nColumns: 22\n$ date                               &lt;date&gt; 2018-09-05, 2018-09-06, 2018-09-07…\n$ total_rainfall                     &lt;dbl&gt; -0.2970185, -0.2970185, -0.1773679,…\n$ total_snowfall                     &lt;dbl&gt; -0.2179228, -0.2179228, -0.2179228,…\n$ avg_temperature                    &lt;dbl&gt; 0.942813132, 0.977863864, 0.8001318…\n$ avg_humidity                       &lt;dbl&gt; 0.21420205, 0.81794255, -0.11561916…\n$ avg_wind_speed                     &lt;dbl&gt; 1.32331031, 0.28870706, 1.28079237,…\n$ avg_visibility                     &lt;dbl&gt; 1.05187245, 0.41451440, 0.84111295,…\n$ avg_dew_point_temp                 &lt;dbl&gt; 0.87630133, 1.09270791, 0.66181269,…\n$ avg_solar_radiation                &lt;dbl&gt; 1.17578189, -0.32588618, 0.79740883…\n$ total_bike_count                   &lt;dbl&gt; 31114, 27838, 30381, 29813, 28354, …\n$ season_Spring                      &lt;dbl&gt; -0.5835555, -0.5835555, -0.5835555,…\n$ season_Summer                      &lt;dbl&gt; -0.595246, -0.595246, -0.595246, -0…\n$ season_Winter                      &lt;dbl&gt; -0.5835555, -0.5835555, -0.5835555,…\n$ holiday_No.Holiday                 &lt;dbl&gt; 0.1984324, 0.1984324, 0.1984324, 0.…\n$ day_type_weekend                   &lt;dbl&gt; -0.6362954, -0.6362954, -0.6362954,…\n$ season_Spring_x_holiday_No.Holiday &lt;dbl&gt; -0.1157963, -0.1157963, -0.1157963,…\n$ holiday_No.Holiday_x_season_Summer &lt;dbl&gt; -0.1181161, -0.1181161, -0.1181161,…\n$ holiday_No.Holiday_x_season_Winter &lt;dbl&gt; -0.1157963, -0.1157963, -0.1157963,…\n$ season_Spring_x_avg_temperature    &lt;dbl&gt; -0.550183751, -0.570637797, -0.4669…\n$ season_Summer_x_avg_temperature    &lt;dbl&gt; -0.561205702, -0.582069508, -0.4762…\n$ season_Winter_x_avg_temperature    &lt;dbl&gt; -0.550183751, -0.570637797, -0.4669…\n$ avg_temperature_x_total_rainfall   &lt;dbl&gt; -0.280032902, -0.290443616, -0.1419…\n\n\n\n\nRecipe 3\n\nrecipe3 &lt;- recipe2 |&gt;\n  step_poly(avg_temperature, total_rainfall, total_snowfall, avg_humidity, \n            avg_wind_speed, avg_visibility, avg_dew_point_temp, \n            avg_solar_radiation, degree = 2)\n\n\nshow_glimpse(recipe3)\n\nRows: 263\nColumns: 30\n$ date                               &lt;date&gt; 2018-09-05, 2018-09-06, 2018-09-07…\n$ total_bike_count                   &lt;dbl&gt; 31114, 27838, 30381, 29813, 28354, …\n$ season_Spring                      &lt;dbl&gt; -0.5835555, -0.5835555, -0.5835555,…\n$ season_Summer                      &lt;dbl&gt; -0.595246, -0.595246, -0.595246, -0…\n$ season_Winter                      &lt;dbl&gt; -0.5835555, -0.5835555, -0.5835555,…\n$ holiday_No.Holiday                 &lt;dbl&gt; 0.1984324, 0.1984324, 0.1984324, 0.…\n$ day_type_weekend                   &lt;dbl&gt; -0.6362954, -0.6362954, -0.6362954,…\n$ season_Spring_x_holiday_No.Holiday &lt;dbl&gt; -0.1157963, -0.1157963, -0.1157963,…\n$ holiday_No.Holiday_x_season_Summer &lt;dbl&gt; -0.1181161, -0.1181161, -0.1181161,…\n$ holiday_No.Holiday_x_season_Winter &lt;dbl&gt; -0.1157963, -0.1157963, -0.1157963,…\n$ season_Spring_x_avg_temperature    &lt;dbl&gt; -0.550183751, -0.570637797, -0.4669…\n$ season_Summer_x_avg_temperature    &lt;dbl&gt; -0.561205702, -0.582069508, -0.4762…\n$ season_Winter_x_avg_temperature    &lt;dbl&gt; -0.550183751, -0.570637797, -0.4669…\n$ avg_temperature_x_total_rainfall   &lt;dbl&gt; -0.280032902, -0.290443616, -0.1419…\n$ avg_temperature_poly_1             &lt;dbl&gt; 0.0582471898, 0.0604126312, 0.04943…\n$ avg_temperature_poly_2             &lt;dbl&gt; 4.343638e-03, 8.936806e-03, -1.2777…\n$ total_rainfall_poly_1              &lt;dbl&gt; -0.018349862, -0.018349862, -0.0109…\n$ total_rainfall_poly_2              &lt;dbl&gt; 0.017787545, 0.017787545, -0.002471…\n$ total_snowfall_poly_1              &lt;dbl&gt; -0.01346331, -0.01346331, -0.013463…\n$ total_snowfall_poly_2              &lt;dbl&gt; 0.007912355, 0.007912355, 0.0079123…\n$ avg_humidity_poly_1                &lt;dbl&gt; 0.013233447, 0.050532660, -0.007142…\n$ avg_humidity_poly_2                &lt;dbl&gt; -0.049710700, -0.025703529, -0.0475…\n$ avg_wind_speed_poly_1              &lt;dbl&gt; 0.081754384, 0.017836382, 0.0791276…\n$ avg_wind_speed_poly_2              &lt;dbl&gt; -0.022889314, -0.051814842, -0.0259…\n$ avg_visibility_poly_1              &lt;dbl&gt; 0.064984897, 0.025608785, 0.0519641…\n$ avg_visibility_poly_2              &lt;dbl&gt; 0.052485925, -0.039054487, 0.016026…\n$ avg_dew_point_temp_poly_1          &lt;dbl&gt; 0.054138077, 0.067507720, 0.0408869…\n$ avg_dew_point_temp_poly_2          &lt;dbl&gt; 0.0010118908, 0.0310969311, -0.0230…\n$ avg_solar_radiation_poly_1         &lt;dbl&gt; 0.072640048, -0.020133316, 0.049264…\n$ avg_solar_radiation_poly_2         &lt;dbl&gt; 0.008080770, -0.053656723, -0.03538…\n\n\n\n\n\nSet Up the Linear Model Engine\n\nlm_spec &lt;- linear_reg() %&gt;% set_engine(\"lm\") \n\nlm_spec\n\nLinear Regression Model Specification (regression)\n\nComputational engine: lm \n\n\n\n\nWorkflows\nWe need to send each recipe through the workflow to get the results.\n\nworkflow_and_results &lt;- function(recipe) {\n  workflow &lt;- workflow() |&gt;\n    add_recipe(recipe) |&gt;\n    add_model(lm_spec)\n    \n  results &lt;- fit_resamples(\n    workflow,\n    resamples = cv_folds,\n    metrics = metric_set(rmse)\n  )\n  \n  results\n}\n\nresults1 &lt;- workflow_and_results(recipe1)\nresults2 &lt;- workflow_and_results(recipe2)\n\n→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient=\"NA\")\n\n\nThere were issues with some computations   A: x1\nThere were issues with some computations   A: x1\n\n\n\n\nresults3 &lt;- workflow_and_results(recipe3)\n\n→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient=\"NA\")\n\n\nThere were issues with some computations   A: x1\nThere were issues with some computations   A: x1\n\n\n\n\n\n\nall_results &lt;- bind_rows(\n  results1 |&gt; collect_metrics() |&gt; mutate(model = \"No Interactions\"),\n  results2 |&gt; collect_metrics() |&gt; mutate(model = \"Interactions\"),\n  results3 |&gt; collect_metrics() |&gt; mutate(model = \"Interactions + Poly\")\n)\n\nggplot(all_results, aes(x = model, y = mean, group = .metric, color = .metric)) +\n  geom_line() +\n  geom_point(size = 3) +\n  geom_point(data = slice_min(all_results, order_by = mean, n = 1), \n             shape = 1, color = \"black\", size = 6, stroke = 1.5) +\n  labs(title = \"Model Performance Comparison\", x = \"Model\", y = \"RMSE\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")"
  },
  {
    "objectID": "HW8.html#fit-best-model",
    "href": "HW8.html#fit-best-model",
    "title": "HW8",
    "section": "Fit Best Model",
    "text": "Fit Best Model\nThe model with interactions and polynomial terms had the minimum RMSE amongst the three tested. With this we will fit that model to the entire training data set.\n\nfinal_workflow &lt;- workflow() |&gt;\n  add_recipe(recipe3) |&gt;\n  add_model(lm_spec)\n\nfinal_fit &lt;- last_fit(final_workflow, split = data_split)\n\nCompute the RMSE metric on the test set.\n\ntest_metrics &lt;- final_fit |&gt; collect_metrics()\ntest_metrics\n\n# A tibble: 2 × 4\n  .metric .estimator .estimate .config             \n  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               \n1 rmse    standard    2911.    Preprocessor1_Model1\n2 rsq     standard       0.919 Preprocessor1_Model1\n\n\nObtain the final model (fit on the entire training set) coefficient table\n\nfinal_coefficients &lt;- final_fit |&gt; \n  extract_fit_parsnip() |&gt; \n  tidy()\n\nfinal_coefficients\n\n# A tibble: 29 × 5\n   term                               estimate std.error statistic  p.value\n   &lt;chr&gt;                                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;\n 1 (Intercept)                          20261.     1602.    12.6   2.81e-28\n 2 season_Spring                        -2127.      264.    -8.06  4.00e-14\n 3 season_Summer                         6316.      973.     6.49  5.07e-10\n 4 season_Winter                        -4972.     1011.    -4.92  1.65e- 6\n 5 holiday_No.Holiday                     932.      217.     4.30  2.48e- 5\n 6 day_type_weekend                     -1106.      180.    -6.14  3.49e- 9\n 7 season_Spring_x_holiday_No.Holiday     156.      317.     0.494 6.22e- 1\n 8 holiday_No.Holiday_x_season_Summer    -239.      246.    -0.971 3.33e- 1\n 9 holiday_No.Holiday_x_season_Winter    -361.      207.    -1.74  8.30e- 2\n10 season_Spring_x_avg_temperature       1924.      492.     3.91  1.21e- 4\n# ℹ 19 more rows"
  }
]